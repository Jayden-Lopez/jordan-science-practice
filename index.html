<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Jordan's Science 6 Practice</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🔬</text></svg>">
    <!-- Version: 2.0 - Parent Dashboard Button Moved to Bottom -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #764ba2;
            font-size: 1.2em;
            font-weight: 500;
        }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 5px 15px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .units-container {
            margin-bottom: 30px;
        }

        .unit-section {
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            background: #f9f9f9;
        }

        .unit-header {
            font-size: 1.5em;
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }

        .chapter-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            border: 3px solid transparent;
        }

        .chapter-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .chapter-card.locked {
            background: linear-gradient(135deg, #9e9e9e 0%, #616161 100%);
            cursor: not-allowed;
            opacity: 0.7;
        }

        .chapter-card.locked:hover {
            transform: none;
        }

        .chapter-card.mastered {
            border-color: #4CAF50;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        }

        .chapter-number {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .chapter-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .chapter-progress {
            font-size: 0.85em;
            opacity: 0.9;
        }

        .lock-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5em;
        }

        .mastery-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            color: #4CAF50;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .practice-screen {
            display: none;
        }

        .practice-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .practice-header h2 {
            margin-bottom: 10px;
        }

        .question-container {
            background: #f9f9f9;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .question-number {
            color: #667eea;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .question-text {
            font-size: 1.3em;
            margin-bottom: 25px;
            line-height: 1.6;
            color: #333;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            font-size: 1.1em;
        }

        .option-btn:hover {
            border-color: #667eea;
            background: #f0f0ff;
        }

        .option-btn.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .option-btn.correct {
            border-color: #4CAF50;
            background: #4CAF50;
            color: white;
        }

        .option-btn.incorrect {
            border-color: #f44336;
            background: #f44336;
            color: white;
        }

        .input-answer {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            margin-top: 10px;
        }

        .input-answer:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-container {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            justify-content: center;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            font-size: 1.1em;
            display: none;
        }

        .feedback.correct {
            background: #4CAF50;
            color: white;
        }

        .feedback.incorrect {
            background: #f44336;
            color: white;
        }

        .parent-dashboard {
            display: none;
            background: #f9f9f9;
            padding: 30px;
            border-radius: 15px;
        }

        .pin-screen {
            text-align: center;
            padding: 50px;
        }

        .pin-input {
            width: 200px;
            padding: 15px;
            font-size: 1.5em;
            text-align: center;
            border: 2px solid #667eea;
            border-radius: 10px;
            margin: 20px auto;
            display: block;
        }

        .progress-chart {
            margin-top: 30px;
        }

        .chapter-progress-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-bar {
            width: 60%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }

        .nav-buttons {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
        }

        .nav-btn {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .nav-btn:hover {
            background: #667eea;
            color: white;
        }

        .hint-container {
            margin-top: 20px;
            text-align: center;
        }

        .hint-btn {
            background: #FFA726;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s;
        }

        .hint-btn:hover {
            background: #FB8C00;
            transform: translateY(-2px);
        }

        .hint-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .hint-display {
            display: none;
            background: #FFF3E0;
            border: 2px solid #FFA726;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            font-size: 1em;
            color: #E65100;
            text-align: left;
        }

        .hint-display.show {
            display: block;
        }

        .incorrect-answers-section {
            margin-top: 30px;
            background: white;
            padding: 20px;
            border-radius: 10px;
        }

        .incorrect-answer-item {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }

        .incorrect-answer-item strong {
            color: #c62828;
        }

        .incorrect-answer-date {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .chapters-grid {
                grid-template-columns: 1fr;
            }

            .stat-item {
                flex: 1 1 45%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Main Menu Screen -->
        <div id="mainMenu">
            <div class="header">
                <h1>🔬 Jordan's Science 6 Practice</h1>
                <div class="subtitle">BJU Press Science Grade 6 - Fourth Edition</div>
            </div>

            <div class="stats-bar">
                <div class="stat-item">
                    <span class="stat-value" id="totalCorrect">0</span>
                    <span class="stat-label">Total Correct</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="totalQuestions">0</span>
                    <span class="stat-label">Questions Answered</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="accuracy">0%</span>
                    <span class="stat-label">Overall Accuracy</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="chaptersCompleted">0</span>
                    <span class="stat-label">Chapters Mastered</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="currentStreak">0</span>
                    <span class="stat-label">Day Streak 🔥</span>
                </div>
            </div>

            <div class="units-container" id="unitsContainer">
                <!-- Units and chapters will be generated here -->
            </div>

            <!-- Parent Dashboard Button -->
            <div class="nav-buttons">
                <button class="nav-btn" onclick="showParentDashboard()">📊 Parent Dashboard</button>
            </div>
        </div>

        <!-- Practice Screen -->
        <div id="practiceScreen" class="practice-screen">
            <div class="practice-header">
                <h2 id="practiceChapterTitle"></h2>
                <div id="practiceProgress"></div>
            </div>

            <div class="question-container">
                <div class="question-number" id="questionNumber"></div>
                <div class="question-text" id="questionText"></div>
                <div id="answerArea"></div>
                <div class="hint-container" id="hintContainer">
                    <button class="hint-btn" id="hintBtn" onclick="showHint()">💡 Show Hint</button>
                    <div class="hint-display" id="hintDisplay"></div>
                </div>
                <div class="feedback" id="feedback"></div>
            </div>

            <div class="button-container">
                <button class="btn btn-secondary" onclick="exitPractice()">Exit to Menu</button>
                <button class="btn btn-primary" id="submitBtn" onclick="submitAnswer()">Submit Answer</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" style="display:none;">Next Question</button>
            </div>
        </div>

        <!-- Parent Dashboard -->
        <div id="parentDashboard" class="parent-dashboard">
            <div id="pinScreen" class="pin-screen">
                <h2>Parent Dashboard Access</h2>
                <p>Enter PIN to view detailed progress</p>
                <input type="password" class="pin-input" id="pinInput" placeholder="Enter PIN" maxlength="4" onkeypress="if(event.key === 'Enter') verifyPin()">
                <button class="btn btn-primary" onclick="verifyPin()">Unlock Dashboard</button>
                <button class="btn btn-secondary" onclick="closeParentDashboard()">Cancel</button>
            </div>

            <div id="dashboardContent" style="display:none;">
                <h2>📊 Jordan's Science Progress Dashboard</h2>
                <button class="btn btn-secondary" onclick="closeParentDashboard()" style="float:right;">Close</button>
                <div class="progress-chart" id="progressChart"></div>
                
                <div style="margin-top: 30px;">
                    <h3>Settings</h3>
                    <button class="btn btn-secondary" onclick="resetProgress()">Reset All Progress</button>
                    <button class="btn btn-secondary" onclick="changePin()">Change PIN</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase v9+ Modular SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, onValue, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase Configuration - Add your config here
        const firebaseConfig = {
            apiKey: "AIzaSyAs7_DlWthyuWVVLbYCo7SQHHt2Siw_DH0",
            authDomain: "jordan-math-practice.firebaseapp.com",
            databaseURL: "https://jordan-math-practice-default-rtdb.firebaseio.com",
            projectId: "jordan-math-practice",
            storageBucket: "jordan-math-practice.firebasestorage.app",
            messagingSenderId: "1011552332362",
            appId: "1:1011552332362:web:8bc57f83156212d63094b3"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        // Make database functions available globally
        window.firebaseDB = {
            database,
            ref,
            set,
            get,
            onValue,
            update
        };
    </script>

    <script>
        // Wait for Firebase module to load, then initialize the app
        let database, ref, set, get, onValue, update;
        
        // Check if Firebase is ready
        function waitForFirebase() {
            if (window.firebaseDB) {
                // Destructure Firebase functions
                ({ database, ref, set, get, onValue, update } = window.firebaseDB);
                // Initialize the app
                init();
            } else {
                // Wait a bit and try again
                setTimeout(waitForFirebase, 100);
            }
        }
        
        // Start waiting for Firebase when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', waitForFirebase);
        } else {
            waitForFirebase();
        }

        // Curriculum Structure - BJU Science 6
        const curriculum = {
            "Unit 1: A Changing Earth": [
                { id: 1, title: "Earthquakes and Volcanoes", page: 3 },
                { id: 2, title: "Weathering and Erosion", page: 25 },
                { id: 3, title: "Natural Resources", page: 51 }
            ],
            "Unit 2: God's Living Creation": [
                { id: 4, title: "Cells and Classification", page: 79 },
                { id: 5, title: "Animal Classification", page: 101 },
                { id: 6, title: "Plant Classification", page: 137 }
            ],
            "Unit 3: Energy in Motion": [
                { id: 7, title: "Atoms and Molecules", page: 161 },
                { id: 8, title: "Electricity and Magnetism", page: 187 },
                { id: 9, title: "Motion and Machines", page: 211 }
            ],
            "Unit 4: Beyond Our Earth": [
                { id: 10, title: "Stars", page: 235 },
                { id: 11, title: "Solar System", page: 259 }
            ],
            "Unit 5: God's Continuing Plan": [
                { id: 12, title: "Plant and Animal Reproduction", page: 289 },
                { id: 13, title: "Heredity and Genetics", page: 309 }
            ],
            "Unit 6: Our Intricate Bodies": [
                { id: 14, title: "Nervous System", page: 335 },
                { id: 15, title: "Immune System", page: 361 }
            ]
        };

        // Question Bank - Sample questions for each chapter
        const questionBank = {
            1: [ // Earthquakes and Volcanoes
                {
                    type: "multiple",
                    question: "What causes earthquakes?",
                    options: [
                        "Movement of tectonic plates",
                        "Wind erosion",
                        "Ocean currents",
                        "Volcanic ash"
                    ],
                    correct: 0,
                    hint: "Think about the large pieces of Earth's crust that slowly move and sometimes collide."
                },
                {
                    type: "multiple",
                    question: "Which type of volcano has steep sides and explosive eruptions?",
                    options: [
                        "Shield volcano",
                        "Composite volcano",
                        "Cinder cone",
                        "Dormant volcano"
                    ],
                    correct: 1,
                    hint: "This volcano is made of layers of lava and ash, creating a cone shape."
                },
                {
                    type: "truefalse",
                    question: "The Ring of Fire is an area with many earthquakes and volcanoes.",
                    correct: true,
                    hint: "This area circles the Pacific Ocean where tectonic plates meet."
                },
                {
                    type: "fillin",
                    question: "The point on Earth's surface directly above an earthquake's focus is called the _______.",
                    correct: "epicenter",
                    hint: "This word starts with 'epi-' which means 'above' or 'on top of'."
                },
                {
                    type: "multiple",
                    question: "What instrument measures the strength of earthquakes?",
                    options: [
                        "Thermometer",
                        "Barometer",
                        "Seismograph",
                        "Anemometer"
                    ],
                    correct: 2,
                    hint: "This device detects and records ground movements and vibrations."
                }
            ],
            2: [ // Weathering and Erosion
                {
                    type: "multiple",
                    question: "What is weathering?",
                    options: [
                        "The movement of rock and soil",
                        "The breaking down of rocks",
                        "The formation of mountains",
                        "The creation of volcanoes"
                    ],
                    correct: 1,
                    hint: "Weathering happens when rocks are broken into smaller pieces over time."
                },
                {
                    type: "truefalse",
                    question: "Chemical weathering occurs when water freezes in cracks in rocks.",
                    correct: false,
                    hint: "Freezing water in cracks is actually physical weathering, not chemical."
                },
                {
                    type: "multiple",
                    question: "Which is an agent of erosion?",
                    options: [
                        "Sunlight",
                        "Oxygen",
                        "Wind",
                        "Temperature"
                    ],
                    correct: 2,
                    hint: "Think about what can pick up and carry soil and rocks from one place to another."
                },
                {
                    type: "fillin",
                    question: "The process of moving weathered rock and soil from one place to another is called _______.",
                    correct: "erosion",
                    hint: "This word describes when weathered materials are transported away."
                },
                {
                    type: "multiple",
                    question: "What type of weathering occurs when rocks are broken down by chemicals?",
                    options: [
                        "Physical weathering",
                        "Mechanical weathering",
                        "Chemical weathering",
                        "Thermal weathering"
                    ],
                    correct: 2,
                    hint: "The answer is in the question - what type involves chemicals?"
                }
            ],
            3: [ // Natural Resources
                {
                    type: "multiple",
                    question: "Which of these is a renewable resource?",
                    options: [
                        "Coal",
                        "Oil",
                        "Solar energy",
                        "Natural gas"
                    ],
                    correct: 2,
                    hint: "Renewable means it can be replaced naturally and won't run out."
                },
                {
                    type: "truefalse",
                    question: "Fossil fuels are formed from ancient plants and animals.",
                    correct: true,
                    hint: "Fossil fuels took millions of years to form from organisms that lived long ago."
                },
                {
                    type: "multiple",
                    question: "What is conservation?",
                    options: [
                        "Using resources wastefully",
                        "Protecting and preserving natural resources",
                        "Creating new resources",
                        "Destroying old resources"
                    ],
                    correct: 1,
                    hint: "Conservation means to save and protect something for the future."
                },
                {
                    type: "fillin",
                    question: "Resources that cannot be replaced in a human lifetime are called _______ resources.",
                    correct: "nonrenewable",
                    hint: "The prefix 'non-' means 'not', so these resources are not renewable."
                },
                {
                    type: "multiple",
                    question: "Which is NOT a fossil fuel?",
                    options: [
                        "Coal",
                        "Oil",
                        "Wind",
                        "Natural gas"
                    ],
                    correct: 2,
                    hint: "Fossil fuels come from ancient organisms. Which one is just moving air?"
                }
            ],
            4: [ // Cells and Classification
                {
                    type: "multiple",
                    question: "What is the basic unit of life?",
                    options: [
                        "Organ",
                        "Tissue",
                        "Cell",
                        "System"
                    ],
                    correct: 2,
                    hint: "This is the smallest living part that makes up all living things."
                },
                {
                    type: "truefalse",
                    question: "All living things are made of cells.",
                    correct: true,
                    hint: "Every organism, from bacteria to humans, is made up of these tiny units."
                },
                {
                    type: "multiple",
                    question: "What part of the cell controls all activities?",
                    options: [
                        "Cell membrane",
                        "Nucleus",
                        "Cytoplasm",
                        "Mitochondria"
                    ],
                    correct: 1,
                    hint: "Think of this as the 'brain' of the cell that contains DNA."
                },
                {
                    type: "fillin",
                    question: "The jelly-like substance inside a cell is called _______.",
                    correct: "cytoplasm",
                    hint: "This gel-like material fills the cell and holds the organelles in place."
                },
                {
                    type: "multiple",
                    question: "What organelle produces energy for the cell?",
                    options: [
                        "Nucleus",
                        "Cell wall",
                        "Mitochondria",
                        "Vacuole"
                    ],
                    correct: 2,
                    hint: "These are often called the 'powerhouse' of the cell."
                }
            ],
            5: [ // Animal Classification
                {
                    type: "multiple",
                    question: "Animals with backbones are called:",
                    options: [
                        "Invertebrates",
                        "Vertebrates",
                        "Amphibians",
                        "Mammals"
                    ],
                    correct: 1,
                    hint: "The word 'vertebrae' refers to the bones in your spine or backbone."
                },
                {
                    type: "truefalse",
                    question: "Insects are vertebrates.",
                    correct: false,
                    hint: "Insects don't have backbones - they have exoskeletons on the outside."
                },
                {
                    type: "multiple",
                    question: "Which group of animals has feathers?",
                    options: [
                        "Mammals",
                        "Reptiles",
                        "Birds",
                        "Fish"
                    ],
                    correct: 2,
                    hint: "Only one group of animals has feathers for flying and staying warm."
                },
                {
                    type: "fillin",
                    question: "Animals that can live both on land and in water are called _______.",
                    correct: "amphibians",
                    hint: "Frogs and salamanders are examples of this animal group."
                },
                {
                    type: "multiple",
                    question: "Which characteristic do all mammals share?",
                    options: [
                        "Lay eggs",
                        "Have scales",
                        "Feed milk to young",
                        "Live in water"
                    ],
                    correct: 2,
                    hint: "Think about what baby mammals drink from their mothers."
                }
            ],
            6: [ // Plant Classification
                {
                    type: "multiple",
                    question: "What do plants need to make their own food?",
                    options: [
                        "Soil, air, and water",
                        "Sunlight, water, and carbon dioxide",
                        "Oxygen, nitrogen, and minerals",
                        "Heat, shade, and wind"
                    ],
                    correct: 1,
                    hint: "Plants use energy from the sun along with water and a gas from the air."
                },
                {
                    type: "truefalse",
                    question: "All plants have flowers.",
                    correct: false,
                    hint: "Think about pine trees and ferns - do they have flowers?"
                },
                {
                    type: "multiple",
                    question: "The process by which plants make food is called:",
                    options: [
                        "Respiration",
                        "Photosynthesis",
                        "Digestion",
                        "Fermentation"
                    ],
                    correct: 1,
                    hint: "'Photo' means light and 'synthesis' means to make or create."
                },
                {
                    type: "fillin",
                    question: "The green pigment in plants that captures sunlight is called _______.",
                    correct: "chlorophyll",
                    hint: "This green substance is what makes leaves green and helps capture sunlight."
                },
                {
                    type: "multiple",
                    question: "Which plant group produces seeds in cones?",
                    options: [
                        "Flowering plants",
                        "Ferns",
                        "Mosses",
                        "Conifers"
                    ],
                    correct: 3,
                    hint: "Pine trees and spruces are examples of this plant group."
                }
            ],
            7: [ // Atoms and Molecules
                {
                    type: "multiple",
                    question: "What is the smallest unit of matter?",
                    options: [
                        "Molecule",
                        "Atom",
                        "Compound",
                        "Element"
                    ],
                    correct: 1,
                    hint: "This is the tiniest particle that still has properties of an element."
                },
                {
                    type: "truefalse",
                    question: "A molecule is made up of two or more atoms bonded together.",
                    correct: true,
                    hint: "Molecules are formed when atoms join together chemically."
                },
                {
                    type: "multiple",
                    question: "The center of an atom is called the:",
                    options: [
                        "Electron",
                        "Proton",
                        "Nucleus",
                        "Neutron"
                    ],
                    correct: 2,
                    hint: "This is the dense core where protons and neutrons are found."
                },
                {
                    type: "fillin",
                    question: "Particles with a negative charge are called _______.",
                    correct: "electrons",
                    hint: "These particles orbit around the nucleus of an atom."
                },
                {
                    type: "multiple",
                    question: "What is H2O?",
                    options: [
                        "An atom",
                        "An element",
                        "A molecule",
                        "A proton"
                    ],
                    correct: 2,
                    hint: "H2O is water, which is made of multiple atoms bonded together."
                }
            ],
            8: [ // Electricity and Magnetism
                {
                    type: "multiple",
                    question: "What is electricity?",
                    options: [
                        "Movement of light",
                        "Flow of electric charge",
                        "Transfer of heat",
                        "Form of sound"
                    ],
                    correct: 1,
                    hint: "Electricity involves tiny charged particles moving through a material."
                },
                {
                    type: "truefalse",
                    question: "Magnets have two poles: north and south.",
                    correct: true,
                    hint: "Every magnet has two opposite ends or poles."
                },
                {
                    type: "multiple",
                    question: "Materials that allow electricity to flow through them easily are called:",
                    options: [
                        "Insulators",
                        "Conductors",
                        "Resistors",
                        "Transformers"
                    ],
                    correct: 1,
                    hint: "Metals like copper and aluminum are good examples of these materials."
                },
                {
                    type: "fillin",
                    question: "A path through which electric current can flow is called a _______.",
                    correct: "circuit",
                    hint: "This word describes a complete loop for electricity to travel through."
                },
                {
                    type: "multiple",
                    question: "What happens when like poles of two magnets are brought together?",
                    options: [
                        "They attract",
                        "They repel",
                        "They stick together",
                        "Nothing happens"
                    ],
                    correct: 1,
                    hint: "Like poles (north-north or south-south) push away from each other."
                }
            ],
            9: [ // Motion and Machines
                {
                    type: "multiple",
                    question: "What is motion?",
                    options: [
                        "Staying in one place",
                        "Change in position",
                        "Standing still",
                        "Being at rest"
                    ],
                    correct: 1,
                    hint: "Motion means something is moving or changing where it is located."
                },
                {
                    type: "truefalse",
                    question: "A simple machine makes work easier.",
                    correct: true,
                    hint: "Simple machines help us do tasks with less effort."
                },
                {
                    type: "multiple",
                    question: "Which is an example of a simple machine?",
                    options: [
                        "Computer",
                        "Lever",
                        "Airplane",
                        "Television"
                    ],
                    correct: 1,
                    hint: "Simple machines have few or no moving parts - think of a seesaw."
                },
                {
                    type: "fillin",
                    question: "The force that pulls objects toward Earth is called _______.",
                    correct: "gravity",
                    hint: "This force keeps us on the ground and makes things fall down."
                },
                {
                    type: "multiple",
                    question: "What does a pulley do?",
                    options: [
                        "Lifts or moves loads",
                        "Creates electricity",
                        "Produces heat",
                        "Makes sound"
                    ],
                    correct: 0,
                    hint: "A pulley uses a rope and wheel to help raise or lower heavy objects."
                }
            ],
            10: [ // Stars
                {
                    type: "multiple",
                    question: "What is the closest star to Earth?",
                    options: [
                        "Alpha Centauri",
                        "Polaris",
                        "The Sun",
                        "Sirius"
                    ],
                    correct: 2,
                    hint: "This star gives us light and warmth every day."
                },
                {
                    type: "truefalse",
                    question: "All stars are the same size and brightness.",
                    correct: false,
                    hint: "Stars come in many different sizes and brightnesses."
                },
                {
                    type: "multiple",
                    question: "What causes a star to shine?",
                    options: [
                        "Reflection of light",
                        "Nuclear fusion",
                        "Burning of fuel",
                        "Chemical reactions"
                    ],
                    correct: 1,
                    hint: "Stars produce energy by combining atoms in their core at extreme temperatures."
                },
                {
                    type: "fillin",
                    question: "A pattern of stars that form a recognizable shape is called a _______.",
                    correct: "constellation",
                    hint: "Examples include the Big Dipper and Orion."
                },
                {
                    type: "multiple",
                    question: "What color are the hottest stars?",
                    options: [
                        "Red",
                        "Yellow",
                        "Blue",
                        "Orange"
                    ],
                    correct: 2,
                    hint: "Think about the hottest part of a flame - it's this color."
                }
            ],
            11: [ // Solar System
                {
                    type: "multiple",
                    question: "How many planets are in our solar system?",
                    options: [
                        "7",
                        "8",
                        "9",
                        "10"
                    ],
                    correct: 1,
                    hint: "Pluto is no longer considered a planet, so count from Mercury to Neptune."
                },
                {
                    type: "truefalse",
                    question: "Jupiter is the largest planet in our solar system.",
                    correct: true,
                    hint: "This gas giant is bigger than all other planets combined."
                },
                {
                    type: "multiple",
                    question: "What is the center of our solar system?",
                    options: [
                        "Earth",
                        "The Moon",
                        "The Sun",
                        "Jupiter"
                    ],
                    correct: 2,
                    hint: "All the planets orbit around this massive star."
                },
                {
                    type: "fillin",
                    question: "The path a planet takes around the sun is called its _______.",
                    correct: "orbit",
                    hint: "This is the curved path that planets follow as they circle the sun."
                },
                {
                    type: "multiple",
                    question: "Which planet is known as the Red Planet?",
                    options: [
                        "Venus",
                        "Mars",
                        "Jupiter",
                        "Saturn"
                    ],
                    correct: 1,
                    hint: "This planet appears reddish because of iron oxide (rust) on its surface."
                }
            ],
            12: [ // Plant and Animal Reproduction
                {
                    type: "multiple",
                    question: "What is reproduction?",
                    options: [
                        "Growing larger",
                        "Producing offspring",
                        "Eating food",
                        "Moving around"
                    ],
                    correct: 1,
                    hint: "This is how living things make more of their own kind."
                },
                {
                    type: "truefalse",
                    question: "All animals lay eggs.",
                    correct: false,
                    hint: "Many mammals give birth to live babies instead of laying eggs."
                },
                {
                    type: "multiple",
                    question: "The male reproductive part of a flower is called the:",
                    options: [
                        "Pistil",
                        "Petal",
                        "Stamen",
                        "Sepal"
                    ],
                    correct: 2,
                    hint: "This part produces pollen in flowers."
                },
                {
                    type: "fillin",
                    question: "The process of transferring pollen from one flower to another is called _______.",
                    correct: "pollination",
                    hint: "Bees and other insects help with this process by carrying pollen."
                },
                {
                    type: "multiple",
                    question: "Which animal gives birth to live young?",
                    options: [
                        "Bird",
                        "Fish",
                        "Reptile",
                        "Mammal"
                    ],
                    correct: 3,
                    hint: "Think about animals like dogs, cats, and humans."
                }
            ],
            13: [ // Heredity and Genetics
                {
                    type: "multiple",
                    question: "What is heredity?",
                    options: [
                        "The passing of traits from parents to offspring",
                        "Learning new behaviors",
                        "Growing older",
                        "Changing colors"
                    ],
                    correct: 0,
                    hint: "This explains why you may look like your parents or grandparents."
                },
                {
                    type: "truefalse",
                    question: "Genes carry information about inherited traits.",
                    correct: true,
                    hint: "Genes are like instruction manuals for our characteristics."
                },
                {
                    type: "multiple",
                    question: "Where are genes located?",
                    options: [
                        "In the blood",
                        "In chromosomes",
                        "In the stomach",
                        "In the lungs"
                    ],
                    correct: 1,
                    hint: "These thread-like structures are found in the nucleus of cells."
                },
                {
                    type: "fillin",
                    question: "A characteristic that is passed from parent to offspring is called a _______.",
                    correct: "trait",
                    hint: "Eye color and hair color are examples of these characteristics."
                },
                {
                    type: "multiple",
                    question: "Who is known as the father of genetics?",
                    options: [
                        "Charles Darwin",
                        "Gregor Mendel",
                        "Louis Pasteur",
                        "Isaac Newton"
                    ],
                    correct: 1,
                    hint: "This monk studied pea plants to understand how traits are inherited."
                }
            ],
            14: [ // Nervous System
                {
                    type: "multiple",
                    question: "What is the control center of the nervous system?",
                    options: [
                        "Heart",
                        "Lungs",
                        "Brain",
                        "Stomach"
                    ],
                    correct: 2,
                    hint: "This organ processes information and sends signals to the rest of your body."
                },
                {
                    type: "truefalse",
                    question: "The spinal cord is part of the nervous system.",
                    correct: true,
                    hint: "The spinal cord is a bundle of nerves that connects the brain to the body."
                },
                {
                    type: "multiple",
                    question: "What carries messages throughout the body?",
                    options: [
                        "Blood vessels",
                        "Muscles",
                        "Nerves",
                        "Bones"
                    ],
                    correct: 2,
                    hint: "These are like wires that send signals from your brain to your body."
                },
                {
                    type: "fillin",
                    question: "The five senses are sight, hearing, touch, taste, and _______.",
                    correct: "smell",
                    hint: "This sense lets you detect odors with your nose."
                },
                {
                    type: "multiple",
                    question: "What protects the brain?",
                    options: [
                        "Skin",
                        "Skull",
                        "Muscles",
                        "Hair"
                    ],
                    correct: 1,
                    hint: "This hard bony structure surrounds and shields the brain."
                }
            ],
            15: [ // Immune System
                {
                    type: "multiple",
                    question: "What does the immune system do?",
                    options: [
                        "Pumps blood",
                        "Fights disease",
                        "Digests food",
                        "Breathes air"
                    ],
                    correct: 1,
                    hint: "This system protects your body from germs and illness."
                },
                {
                    type: "truefalse",
                    question: "White blood cells help fight infection.",
                    correct: true,
                    hint: "These cells are like soldiers that attack germs in your body."
                },
                {
                    type: "multiple",
                    question: "What are germs that cause disease called?",
                    options: [
                        "Antibodies",
                        "Pathogens",
                        "Antigens",
                        "Vaccines"
                    ],
                    correct: 1,
                    hint: "This scientific term describes harmful microorganisms that make us sick."
                },
                {
                    type: "fillin",
                    question: "A substance that helps the body develop immunity to a disease is called a _______.",
                    correct: "vaccine",
                    hint: "Doctors give these as shots to help prevent diseases like measles and flu."
                },
                {
                    type: "multiple",
                    question: "What organ filters blood and fights infection?",
                    options: [
                        "Heart",
                        "Liver",
                        "Spleen",
                        "Stomach"
                    ],
                    correct: 2,
                    hint: "This organ is located near your stomach and removes old blood cells."
                }
            ]
        };

        // State Management
        let currentChapter = null;
        let currentQuestionIndex = 0;
        let currentQuestions = [];
        let sessionStats = {
            correct: 0,
            total: 0
        };
        let userProgress = {};
        let parentSettings = {
            pinHash: hashPin("1234") // Default PIN: 1234
        };

        // Simple hash function for PIN
        function hashPin(pin) {
            let hash = 0;
            for (let i = 0; i < pin.length; i++) {
                hash = ((hash << 5) - hash) + pin.charCodeAt(i);
                hash = hash & hash;
            }
            return Math.abs(hash).toString();
        }

        // Initialize app
        function init() {
            loadProgress();
            loadParentSettings();
            renderUnits();
            updateStats();
            checkDailyStreak();
        }

        // Load progress from Firebase
        function loadProgress() {
            const progressRef = ref(database, 'science/progress');
            get(progressRef).then((snapshot) => {
                if (snapshot.exists()) {
                    userProgress = snapshot.val();
                    // Ensure all chapters have incorrectAnswers array
                    for (let i = 1; i <= 15; i++) {
                        if (userProgress[i] && !userProgress[i].incorrectAnswers) {
                            userProgress[i].incorrectAnswers = [];
                        }
                    }
                } else {
                    // Initialize progress for all chapters
                    for (let i = 1; i <= 15; i++) {
                        userProgress[i] = {
                            correct: 0,
                            total: 0,
                            accuracy: 0,
                            mastered: false,
                            incorrectAnswers: []
                        };
                    }
                    saveProgress();
                }
                renderUnits();
                updateStats();
            }).catch((error) => {
                console.error('Error loading progress:', error);
            });
        }

        // Save progress to Firebase
        function saveProgress() {
            const progressRef = ref(database, 'science/progress');
            set(progressRef, userProgress);
        }

        // Load parent settings
        function loadParentSettings() {
            const settingsRef = ref(database, 'science/parentSettings');
            get(settingsRef).then((snapshot) => {
                if (snapshot.exists()) {
                    parentSettings = snapshot.val();
                } else {
                    set(settingsRef, parentSettings);
                }
            });
        }

        // Check daily streak
        function checkDailyStreak() {
            const today = new Date().toDateString();
            const lastVisitRef = ref(database, 'science/lastVisit');
            get(lastVisitRef).then((snapshot) => {
                const lastVisit = snapshot.val();
                if (lastVisit !== today) {
                    set(lastVisitRef, today);
                    
                    const streakRef = ref(database, 'science/streak');
                    get(streakRef).then((streakSnapshot) => {
                        const currentStreak = streakSnapshot.val() || 0;
                        if (!lastVisit) {
                            set(streakRef, 1);
                        } else {
                            const yesterday = new Date();
                            yesterday.setDate(yesterday.getDate() - 1);
                            if (lastVisit === yesterday.toDateString()) {
                                set(streakRef, currentStreak + 1);
                            } else {
                                set(streakRef, 1);
                            }
                        }
                    });
                }
            });
        }

        // Render units and chapters
        function renderUnits() {
            const container = document.getElementById('unitsContainer');
            container.innerHTML = '';

            Object.keys(curriculum).forEach(unitName => {
                const unitSection = document.createElement('div');
                unitSection.className = 'unit-section';

                const unitHeader = document.createElement('div');
                unitHeader.className = 'unit-header';
                unitHeader.textContent = unitName;
                unitSection.appendChild(unitHeader);

                const chaptersGrid = document.createElement('div');
                chaptersGrid.className = 'chapters-grid';

                curriculum[unitName].forEach(chapter => {
                    const card = createChapterCard(chapter);
                    chaptersGrid.appendChild(card);
                });

                unitSection.appendChild(chaptersGrid);
                container.appendChild(unitSection);
            });
        }

        // Create chapter card
        function createChapterCard(chapter) {
            const card = document.createElement('div');
            const progress = userProgress[chapter.id] || { correct: 0, total: 0, accuracy: 0, mastered: false };
            const isLocked = chapter.id > 1 && !userProgress[chapter.id - 1]?.mastered;

            card.className = 'chapter-card';
            if (isLocked) card.classList.add('locked');
            if (progress.mastered) card.classList.add('mastered');

            card.innerHTML = `
                <div class="chapter-number">Chapter ${chapter.id}</div>
                <div class="chapter-title">${chapter.title}</div>
                <div class="chapter-progress">
                    ${progress.total > 0 ? `${progress.correct}/${progress.total} correct (${Math.round(progress.accuracy)}%)` : 'Not started'}
                </div>
                ${isLocked ? '<div class="lock-icon">🔒</div>' : ''}
                ${progress.mastered ? '<div class="mastery-badge">✓ Mastered</div>' : ''}
            `;

            if (!isLocked) {
                card.onclick = () => startChapter(chapter.id);
            }

            return card;
        }

        // Start chapter practice
        function startChapter(chapterId) {
            currentChapter = chapterId;
            currentQuestions = [...questionBank[chapterId]].sort(() => Math.random() - 0.5);
            currentQuestionIndex = 0;
            sessionStats = { correct: 0, total: 0 };

            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('practiceScreen').style.display = 'block';

            // Find chapter name
            let chapterName = '';
            Object.values(curriculum).forEach(unit => {
                const chapter = unit.find(ch => ch.id === chapterId);
                if (chapter) chapterName = chapter.title;
            });

            document.getElementById('practiceChapterTitle').textContent = `Chapter ${chapterId}: ${chapterName}`;
            showQuestion();
        }

        // Show current question
        function showQuestion() {
            if (currentQuestionIndex >= currentQuestions.length) {
                finishChapter();
                return;
            }

            const question = currentQuestions[currentQuestionIndex];
            document.getElementById('questionNumber').textContent = `Question ${currentQuestionIndex + 1} of ${currentQuestions.length}`;
            document.getElementById('practiceProgress').textContent = `Progress: ${sessionStats.correct}/${sessionStats.total} correct`;
            document.getElementById('questionText').textContent = question.question;
            
            const answerArea = document.getElementById('answerArea');
            answerArea.innerHTML = '';

            if (question.type === 'multiple') {
                const optionsContainer = document.createElement('div');
                optionsContainer.className = 'options-container';
                question.options.forEach((option, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.textContent = option;
                    btn.onclick = () => selectOption(index);
                    optionsContainer.appendChild(btn);
                });
                answerArea.appendChild(optionsContainer);
            } else if (question.type === 'truefalse') {
                const optionsContainer = document.createElement('div');
                optionsContainer.className = 'options-container';
                ['True', 'False'].forEach((option, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.textContent = option;
                    btn.onclick = () => selectOption(index === 0);
                    optionsContainer.appendChild(btn);
                });
                answerArea.appendChild(optionsContainer);
            } else if (question.type === 'fillin') {
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'input-answer';
                input.id = 'fillInAnswer';
                input.placeholder = 'Type your answer here...';
                answerArea.appendChild(input);
            }

            document.getElementById('feedback').style.display = 'none';
            document.getElementById('submitBtn').style.display = 'inline-block';
            document.getElementById('nextBtn').style.display = 'none';

            // Reset hint
            document.getElementById('hintDisplay').classList.remove('show');
            document.getElementById('hintDisplay').textContent = '';
            document.getElementById('hintBtn').disabled = false;
            document.getElementById('hintBtn').textContent = '💡 Show Hint';
            hintUsed = false;
        }

        let selectedAnswer = null;
        let hintUsed = false;

        function showHint() {
            const question = currentQuestions[currentQuestionIndex];
            const hintDisplay = document.getElementById('hintDisplay');
            const hintBtn = document.getElementById('hintBtn');

            if (question.hint) {
                hintDisplay.textContent = question.hint;
                hintDisplay.classList.add('show');
                hintBtn.disabled = true;
                hintBtn.textContent = '💡 Hint Shown';
                hintUsed = true;
            }
        }

        function selectOption(index) {
            selectedAnswer = index;
            document.querySelectorAll('.option-btn').forEach((btn, i) => {
                btn.classList.remove('selected');
                if (i === index) btn.classList.add('selected');
            });
        }

        function submitAnswer() {
            const question = currentQuestions[currentQuestionIndex];
            let isCorrect = false;
            let userAnswer = null;

            if (question.type === 'multiple' || question.type === 'truefalse') {
                if (selectedAnswer === null) {
                    alert('Please select an answer!');
                    return;
                }
                userAnswer = selectedAnswer;
                isCorrect = selectedAnswer === question.correct;
            } else if (question.type === 'fillin') {
                userAnswer = document.getElementById('fillInAnswer').value.trim().toLowerCase();
                if (!userAnswer) {
                    alert('Please enter an answer!');
                    return;
                }
                isCorrect = userAnswer === question.correct.toLowerCase();
            }

            sessionStats.total++;
            if (isCorrect) sessionStats.correct++;

            // Track incorrect answers
            if (!isCorrect) {
                if (!userProgress[currentChapter]) {
                    userProgress[currentChapter] = {
                        correct: 0,
                        total: 0,
                        accuracy: 0,
                        mastered: false,
                        incorrectAnswers: []
                    };
                }
                if (!userProgress[currentChapter].incorrectAnswers) {
                    userProgress[currentChapter].incorrectAnswers = [];
                }

                let userAnswerText = '';
                let correctAnswerText = '';

                if (question.type === 'multiple') {
                    userAnswerText = question.options[userAnswer];
                    correctAnswerText = question.options[question.correct];
                } else if (question.type === 'truefalse') {
                    userAnswerText = userAnswer ? 'True' : 'False';
                    correctAnswerText = question.correct ? 'True' : 'False';
                } else {
                    userAnswerText = userAnswer;
                    correctAnswerText = question.correct;
                }

                const incorrectRecord = {
                    question: question.question,
                    userAnswer: userAnswerText,
                    correctAnswer: correctAnswerText,
                    date: new Date().toLocaleDateString(),
                    hintUsed: hintUsed
                };

                userProgress[currentChapter].incorrectAnswers.unshift(incorrectRecord);
                // Keep only last 20 incorrect answers per chapter
                if (userProgress[currentChapter].incorrectAnswers.length > 20) {
                    userProgress[currentChapter].incorrectAnswers =
                        userProgress[currentChapter].incorrectAnswers.slice(0, 20);
                }
            }

            const feedback = document.getElementById('feedback');
            feedback.style.display = 'block';
            feedback.className = 'feedback ' + (isCorrect ? 'correct' : 'incorrect');

            if (isCorrect) {
                feedback.textContent = '✓ Correct! Great job!';
            } else {
                if (question.type === 'multiple') {
                    feedback.textContent = `✗ Not quite. The correct answer is: ${question.options[question.correct]}`;
                } else if (question.type === 'truefalse') {
                    feedback.textContent = `✗ Not quite. The correct answer is: ${question.correct ? 'True' : 'False'}`;
                } else {
                    feedback.textContent = `✗ Not quite. The correct answer is: ${question.correct}`;
                }
            }

            // Visual feedback on options
            if (question.type === 'multiple' || question.type === 'truefalse') {
                document.querySelectorAll('.option-btn').forEach((btn, i) => {
                    btn.onclick = null;
                    if (i === question.correct) {
                        btn.classList.add('correct');
                    } else if (i === selectedAnswer && !isCorrect) {
                        btn.classList.add('incorrect');
                    }
                });
            }

            document.getElementById('submitBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'inline-block';
            selectedAnswer = null;
        }

        function nextQuestion() {
            currentQuestionIndex++;
            showQuestion();
        }

        function finishChapter() {
            // Update progress
            if (!userProgress[currentChapter]) {
                userProgress[currentChapter] = { correct: 0, total: 0, accuracy: 0, mastered: false, incorrectAnswers: [] };
            }
            if (!userProgress[currentChapter].incorrectAnswers) {
                userProgress[currentChapter].incorrectAnswers = [];
            }

            userProgress[currentChapter].correct += sessionStats.correct;
            userProgress[currentChapter].total += sessionStats.total;
            userProgress[currentChapter].accuracy = (userProgress[currentChapter].correct / userProgress[currentChapter].total) * 100;

            // Check for mastery (80% accuracy and at least 5 questions)
            if (userProgress[currentChapter].accuracy >= 80 && userProgress[currentChapter].total >= 5) {
                userProgress[currentChapter].mastered = true;
            }

            saveProgress();

            const accuracy = Math.round((sessionStats.correct / sessionStats.total) * 100);
            const message = `Chapter Complete!\n\nYou got ${sessionStats.correct} out of ${sessionStats.total} correct (${accuracy}%)\n\n${
                userProgress[currentChapter].mastered ? '🎉 Chapter Mastered!' : 'Keep practicing to master this chapter!'
            }`;

            alert(message);
            exitPractice();
        }

        function exitPractice() {
            document.getElementById('practiceScreen').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'block';
            renderUnits();
            updateStats();
        }

        function updateStats() {
            let totalCorrect = 0;
            let totalQuestions = 0;
            let chaptersCompleted = 0;

            Object.values(userProgress).forEach(progress => {
                totalCorrect += progress.correct || 0;
                totalQuestions += progress.total || 0;
                if (progress.mastered) chaptersCompleted++;
            });

            document.getElementById('totalCorrect').textContent = totalCorrect;
            document.getElementById('totalQuestions').textContent = totalQuestions;
            document.getElementById('accuracy').textContent = totalQuestions > 0 ? 
                Math.round((totalCorrect / totalQuestions) * 100) + '%' : '0%';
            document.getElementById('chaptersCompleted').textContent = chaptersCompleted;

            // Update streak
            const streakRef = ref(database, 'science/streak');
            get(streakRef).then((snapshot) => {
                document.getElementById('currentStreak').textContent = snapshot.val() || 0;
            });
        }

        // Parent Dashboard Functions
        function showParentDashboard() {
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('practiceScreen').style.display = 'none';
            document.getElementById('parentDashboard').style.display = 'block';
            document.getElementById('pinScreen').style.display = 'block';
            document.getElementById('dashboardContent').style.display = 'none';
            document.getElementById('pinInput').value = '';
        }

        function verifyPin() {
            const enteredPin = document.getElementById('pinInput').value;
            if (hashPin(enteredPin) === parentSettings.pinHash) {
                document.getElementById('pinScreen').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'block';
                renderProgressChart();
            } else {
                alert('Incorrect PIN. Please try again.');
                document.getElementById('pinInput').value = '';
            }
        }

        function closeParentDashboard() {
            document.getElementById('parentDashboard').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'block';
        }

        function renderProgressChart() {
            const chartContainer = document.getElementById('progressChart');
            chartContainer.innerHTML = '<h3>Chapter Progress</h3>';

            for (let i = 1; i <= 15; i++) {
                const progress = userProgress[i] || { correct: 0, total: 0, accuracy: 0, mastered: false, incorrectAnswers: [] };
                const item = document.createElement('div');
                item.className = 'chapter-progress-item';

                let chapterName = '';
                Object.values(curriculum).forEach(unit => {
                    const chapter = unit.find(ch => ch.id === i);
                    if (chapter) chapterName = chapter.title;
                });

                item.innerHTML = `
                    <div style="flex: 1;">
                        <strong>Ch ${i}: ${chapterName}</strong><br>
                        ${progress.total > 0 ? `${progress.correct}/${progress.total} (${Math.round(progress.accuracy)}%)` : 'Not started'}
                        ${progress.mastered ? ' ✓ Mastered' : ''}
                        ${progress.incorrectAnswers && progress.incorrectAnswers.length > 0 ?
                            `<br><button class="btn btn-secondary" style="font-size: 0.8em; padding: 5px 10px; margin-top: 5px;" onclick="showIncorrectAnswers(${i})">
                                View ${progress.incorrectAnswers.length} Incorrect Answer${progress.incorrectAnswers.length > 1 ? 's' : ''}
                            </button>` : ''}
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${Math.min(progress.accuracy, 100)}%"></div>
                    </div>
                `;
                chartContainer.appendChild(item);
            }
        }

        function showIncorrectAnswers(chapterId) {
            const progress = userProgress[chapterId];
            if (!progress || !progress.incorrectAnswers || progress.incorrectAnswers.length === 0) {
                alert('No incorrect answers recorded for this chapter.');
                return;
            }

            let chapterName = '';
            Object.values(curriculum).forEach(unit => {
                const chapter = unit.find(ch => ch.id === chapterId);
                if (chapter) chapterName = chapter.title;
            });

            let html = `
                <div class="incorrect-answers-section">
                    <h3>Incorrect Answers - Chapter ${chapterId}: ${chapterName}</h3>
                    <button class="btn btn-secondary" onclick="renderProgressChart()" style="margin-bottom: 15px;">← Back to Progress</button>
            `;

            progress.incorrectAnswers.forEach((answer, index) => {
                html += `
                    <div class="incorrect-answer-item">
                        <strong>Question:</strong> ${answer.question}<br>
                        <strong>Your Answer:</strong> ${answer.userAnswer}<br>
                        <strong>Correct Answer:</strong> ${answer.correctAnswer}<br>
                        ${answer.hintUsed ? '<em>💡 Hint was used</em><br>' : ''}
                        <div class="incorrect-answer-date">Answered on: ${answer.date}</div>
                    </div>
                `;
            });

            html += '</div>';
            document.getElementById('progressChart').innerHTML = html;
        }

        function resetProgress() {
            if (confirm('Are you sure you want to reset ALL progress? This cannot be undone.')) {
                if (confirm('This will delete all of Jordan\'s progress. Are you REALLY sure?')) {
                    userProgress = {};
                    for (let i = 1; i <= 15; i++) {
                        userProgress[i] = {
                            correct: 0,
                            total: 0,
                            accuracy: 0,
                            mastered: false,
                            incorrectAnswers: []
                        };
                    }
                    saveProgress();
                    const streakRef = ref(database, 'science/streak');
                    set(streakRef, 0);
                    alert('All progress has been reset.');
                    closeParentDashboard();
                    renderUnits();
                    updateStats();
                }
            }
        }

        function changePin() {
            const newPin = prompt('Enter new 4-digit PIN:');
            if (newPin && newPin.length === 4 && !isNaN(newPin)) {
                parentSettings.pinHash = hashPin(newPin);
                const settingsRef = ref(database, 'science/parentSettings');
                set(settingsRef, parentSettings);
                alert('PIN changed successfully!');
            } else {
                alert('Invalid PIN. Must be 4 digits.');
            }
        }

        // Note: init() is called from waitForFirebase() after Firebase loads
    </script>
</body>
</html>
